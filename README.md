# l2tp-universal-script
Универсальный Bash-скрипт для автоматизированной настройки L2TP VPN сервера на Linux с множественными исходящими IP-адресами и автоматической выдачей всех данных для клиентов после установки.

## Описание
Этот скрипт автоматически:
- Определяет основной и дополнительные IP-адреса сервера
- Конфигурирует L2TP/IPsec VPN сервер
- Создает учетные записи пользователей
- Настраивает iptables SNAT для множественных исходящих IP
- Выводит цветную таблицу всех пользователей с их данными
- Сохраняет конфигурацию в текстовый файл

## Быстрая установка
```
wget -O - https://raw.githubusercontent.com/Mortyo666/l2tp-universal-script/main/l2tp-universal.sh | bash
```

## Новое: Явный пул исходящих IP и фильтрация авто-IP
- Можно задать явный список исходящих IP через переменную окружения OUTGOING_IPS:
  - Пример: OUTGOING_IPS="1.2.3.4 5.6.7.8" bash l2tp-universal.sh
  - В этом режиме используется ТОЛЬКО заданный список; служебные/локальные/авто-IP не затрагиваются.
- В авто-режиме скрипт фильтрует исходящие IP:
  - Исключаются служебные: 10.180.1.1, 10.180.2.1, 10.180.5.1
  - Исключаются локальные диапазоны: 10.0.0.0/8, 192.168.0.0/16, 172.16.0.0/12, 127.0.0.0/8, 169.254.0.0/16, 100.64.0.0/10
- Распределение исходящих IP по пользователям:
  - Каждому пользователю выдается уникальный OUTGOING_IP из списка по порядку
  - Если IP меньше, чем пользователей — выводится предупреждение; оставшиеся пользователи используют первый IP
  - Если IP больше, чем пользователей — используются только нужные по количеству

## Что выдает скрипт
После установки вы получите:
- Username (имя пользователя)
- Password (пароль)
- Internal IP (внутренний IP)
- Outgoing IP (исходящий IP)
- Все данные сохраняются в файл для последующего использования

## Параметры пула клиентов
- Подсеть: по умолчанию 10.99.0.0/24 (настраивается через POOL_SUBNET)
- Диапазон: 10.99.0.10 - 10.99.0.250 (POOL_START / POOL_END)

## Требования
- Linux сервер (Ubuntu, Debian, CentOS)
- Root права
- Минимум 1 GB RAM
- Открытые порты: UDP 500, 4500, 1701

## Лицензия
MIT
